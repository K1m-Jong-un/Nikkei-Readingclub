<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日本経済新聞を読む会 | 資料アーカイブ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Noto Serif JP for intellectual vibe -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['"Noto Serif JP"', 'serif'],
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    },
                    colors: {
                        theme: {
                            main: '#003366',    /* Dark Navy (Specified) */
                            accent: '#b91c1c',
                            bg: '#f8f9fa',
                            sub: '#F0F8FF',     /* Alice Blue */
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Noto Sans JP', sans-serif;
            color: #333;
        }
        h1, h2, h3, .serif-font {
            font-family: 'Noto Serif JP', serif;
        }
        
        /* New Card Specification Styles */
        .academic-card {
            background-color: white;
            border-top: 5px solid #003366; /* Important Requirement */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        .academic-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Loading Spinner */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #003366;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-30 flex-shrink-0 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <!-- Logo / Title Link -->
            <a href="https://k1m-jong-un.github.io/Nikkei-Readingclub/" class="flex items-center gap-4 cursor-pointer group hover:opacity-90 transition-opacity">
                <!-- Icon: Newspaper Design per Spec -->
                <div class="w-12 h-12 bg-theme-main rounded-xl flex items-center justify-center shadow-sm group-hover:scale-105 transition-transform">
                    <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                    </svg>
                </div>
                
                <div class="flex flex-col justify-center">
                    <h1 class="text-xl font-bold tracking-wide leading-none text-theme-main group-hover:text-blue-800 transition-colors">日本経済新聞を読む会</h1>
                    <span class="text-xs text-gray-500 mt-1 group-hover:text-gray-700">資料アーカイブ</span>
                </div>
            </a>

            <!-- Right Side Navigation & Controls -->
            <div class="flex items-center gap-2">
                <!-- Home Link -->
                <a href="https://k1m-jong-un.github.io/Nikkei-Readingclub/" class="text-sm font-medium text-gray-500 hover:text-theme-main flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-50 transition-colors" title="サークルトップへ戻る">
                    <i class="fa-solid fa-house"></i>
                    <span class="hidden sm:inline">ホーム</span>
                </a>

                <!-- Viewer Controls -->
                <div id="viewer-controls" class="hidden flex items-center gap-3 pl-2 border-l border-gray-200 ml-2">
                    <button onclick="showGallery()" class="text-sm font-medium text-gray-600 hover:text-theme-main flex items-center gap-2 px-3 py-2 transition-colors">
                        <i class="fa-solid fa-arrow-left"></i>
                        <span>一覧へ戻る</span>
                    </button>
                    <div class="h-4 w-px bg-gray-300 mx-2 hidden sm:block"></div>
                    <button onclick="document.getElementById('file-upload').click()" class="bg-theme-main hover:bg-blue-900 text-white text-sm px-4 py-2 rounded-sm transition shadow-sm flex items-center gap-2">
                        <i class="fa-solid fa-upload"></i>
                        <span class="hidden sm:inline">ファイルを開く</span>
                    </button>
                    <input type="file" id="file-upload" accept="application/pdf" class="hidden">
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 relative overflow-hidden flex flex-col">
        
        <!-- === VIEW 1: Gallery (New Card Layout) === -->
        <div id="gallery-view" class="flex-1 overflow-y-auto bg-gray-50">
            <div class="max-w-6xl mx-auto px-4 py-12">
                <!-- Page Header -->
                <div class="mb-10 text-center">
                    <h2 class="text-3xl font-bold text-gray-800 mb-3 font-serif">活動報告・記事アーカイブ</h2>
                    <p class="text-gray-500 text-sm">
                        部員による研究レポート、読書会のレジュメ、定期発行の部誌などを保管しています。<br>
                        クリックで詳細な内容（PDF）を閲覧できます。
                    </p>
                </div>

                <!-- Article Grid (Changed to Grid for new card design) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="card-container">
                    <!-- Javascript will populate this -->
                </div>
            </div>
        </div>

        <!-- === VIEW 2: PDF Viewer === -->
        <div id="pdf-view" class="hidden flex-1 relative flex flex-col bg-gray-100 h-full">
            
            <!-- Viewer Toolbar -->
            <div id="toolbar" class="bg-white border-b border-gray-200 px-4 py-2 flex flex-wrap items-center justify-between shadow-sm z-20">
                <div class="flex items-center gap-4">
                    <h3 id="current-doc-title" class="text-sm font-bold text-gray-700 truncate max-w-[200px] hidden sm:block">
                        ドキュメント
                    </h3>
                </div>

                <div class="flex items-center gap-3 bg-gray-50 rounded px-2 py-1 border border-gray-200">
                    <button id="prev" class="p-1.5 text-gray-600 hover:text-black hover:bg-gray-200 rounded transition disabled:opacity-30">
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>
                    <span class="text-sm font-medium text-gray-600">
                        <input type="number" id="page-num" value="1" min="1" class="w-10 text-center bg-transparent border-b border-gray-400 focus:outline-none focus:border-theme-main">
                        / <span id="page-count">--</span>
                    </span>
                    <button id="next" class="p-1.5 text-gray-600 hover:text-black hover:bg-gray-200 rounded transition disabled:opacity-30">
                        <i class="fa-solid fa-chevron-right"></i>
                    </button>
                </div>

                <div class="flex items-center gap-2">
                    <button id="zoom-out" class="p-2 text-gray-500 hover:text-gray-900 transition"><i class="fa-solid fa-minus"></i></button>
                    <span id="zoom-level" class="text-xs font-medium w-10 text-center text-gray-500">100%</span>
                    <button id="zoom-in" class="p-2 text-gray-500 hover:text-gray-900 transition"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>

            <!-- Upload Placeholder -->
            <div id="upload-prompt" class="absolute inset-0 flex flex-col items-center justify-center p-6 text-center bg-gray-50 z-10">
                <div class="max-w-md w-full border border-gray-300 bg-white p-10 shadow-sm text-center" id="drop-zone">
                    <div class="mb-4 text-gray-300">
                        <i class="fa-regular fa-file-pdf text-5xl"></i>
                    </div>
                    <h3 class="serif-font text-xl font-bold text-gray-800 mb-2" id="prompt-title">PDF閲覧モード</h3>
                    <p class="text-sm text-gray-500 mb-6 leading-relaxed">
                        サーバー上のファイルへのアクセス権限がないため、<br>
                        デモ用にローカルファイルを読み込みます。
                    </p>
                    <button onclick="document.getElementById('file-upload').click()" class="bg-theme-main text-white px-6 py-2 text-sm font-medium hover:bg-blue-900 transition w-full">
                        ファイルを選択またはドロップ
                    </button>
                </div>
            </div>

            <!-- Canvas Container -->
            <div id="viewer-container" class="flex-1 overflow-auto flex justify-center p-4 md:p-8 bg-gray-200 relative z-0">
                <canvas id="the-canvas" class="shadow-lg mx-auto bg-white hidden"></canvas>
            </div>

            <!-- Loading Spinner -->
            <div id="loading" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-white/90 z-30">
                <div class="loading-spinner mb-4"></div>
                <p class="serif-font text-gray-600 text-sm tracking-widest">LOADING</p>
            </div>

            <!-- Error Notification -->
            <div id="error-message" class="hidden absolute top-20 left-1/2 transform -translate-x-1/2 bg-red-50 border border-red-200 text-red-800 px-6 py-4 shadow-lg flex items-center gap-4 z-50 max-w-sm w-full">
                <i class="fa-solid fa-circle-exclamation text-lg text-red-600"></i>
                <div class="flex-1">
                    <p class="font-bold text-sm">エラーが発生しました</p>
                    <p id="error-text" class="text-xs mt-1 text-red-600 opacity-80">ファイルを読み込めませんでした。</p>
                </div>
                <button onclick="document.getElementById('error-message').classList.add('hidden')" class="text-red-400 hover:text-red-700">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
        </div>
    </main>

    <script>
        // --- DATA: Sample Articles (Updated Structure) ---
        // 修正: 各データに filename プロパティを追加しました。
        // 後からこの "CHANGE_ME.pdf" の部分を実際のファイル名に書き換えてください。
        const pdfData = [
            {
                id: 1,
                title: "ステーブルコインの変革と企業財務",
                filename: "Stablecoin-JPYC.pdf",
                tags: ["経済", "金融", "日本"],
                date: "2025.11.3",
                author_attr: "３年　那須 陽向",
                perspective: "企業CFの改善、資金調達の選択肢、会計監査の精緻化、不正防止、日本国債の需要増などの影響がある考えられるのではないか？と考えた。",
                discussion: "実際問題、どのように社会に実装し、それを浸透させるのか？特に、企業インセンティブの視点について議論した。"
            },
            {
                id: 2,
                title: "参議院、給付・減税前面　党首討論「賃上げ最重要」公示",
                filename: "sangiinn-genzei.pdf",
                tags: ["政治", "税金", "日本"],
                date: "2025.7.7",
                author_attr: "３年　伊知地 秋士",
                perspective: "給付による問題解決の継続性と世論の評価。そして、政策の意味と国民生活への本質的な対応・姿勢による視点の重要性を考えた。",
                discussion: "減税は果たして正しいのか？特に消費税減税によるインフレのメリットとデメリットについて。減税の優先順位。世論と政策の目的の乖離とその誤謬について議論した。"
            },
            {
                id: 3,
                title: "トヨタ、関税上昇分を負担",
                filename: "toyota-kanzei.pdf",
                tags: ["ビジネス", "アメリカ", "車両"],
                date: "2025.4.28",
                author_attr: "３年　坂井 勇魚",
                perspective: "関税対策として、自社負担したことの有益性。特に、長期的なサプライチェーンの影響と販売数量減少による損失などを防いだのではないかと考えた。",
                discussion: "関税対策として、本当に有用であるか？具体的には、利益率の減少と売上の減少どちらの方が損失であるかについて。また、アメリカに生産拠点がない企業への影響について議論した。"
            },
            {
                id: 4,
                title: "米信用市場に火種、隠れ債務 サブプライムで破綻続発 08年との類似",
                filename: "subplime-usacar.pdf",
                tags: ["経済", "アメリカ", "金融"],
                date: "2025.10.6",
                author_attr: "３年　那須 陽向",
                perspective: "リーマンショック程の規模・長さにはならないと考える。根拠として、デフォルトとのシナジー、デフォルト＝資産価格の低下ではない。つまり、資産の違い(不動産‐自動車)である。と考えた。",
                discussion: "リーマンショックの概要と再確認を行い、信用不安の重大さを認識。さらに、金融によるレバレッジの利点・欠点について論じた。"
            },
            {
                id: 5,
                title: "「令和の米騒動」機に農政出直しを",
                filename: "nousei-minaosi.pdf",
                tags: ["社会", "日本", "食料品"],
                date: "2025.6.9",
                author_attr: "３年　井良沢 陸人",
                perspective: "当該騒動は、1970年頃からの米の生産調整が現状ではないかと考え、デモ等が発生してる現在の世論を鑑みると、地政学リスクを踏まえて、世論との意見調整が必要であると考えた。",
                discussion: "まず、現在の農政の問題点と米農家が抱える問題(特に経済面)について洗い出し、その後、記事を基に生産量と受給などの論点を基にどのような政策が必要であるかを論じた。"
            },
            {
                id: 6,
                title: "灰色のサイの始動　トランププット米金利",
                filename: "trunpput-interest.pdf",
                tags: ["経済", "アメリカ", "為替・株式"],
                date: "2025.4.14",
                author_attr: "３年　那須 陽向",
                perspective: "トランプ氏が相互関税を発表した際に、米債券が急落したことは予想外で、株安は容認できるが債権価格の下落は予定外だったのではと推測した。そのため、利払い負担等の懸念によって、90日間の一時停止を行ったのではないかと考えた。",
                discussion: "「灰色のサイ」と呼ばれる米国債の概要を理解し、米国債の下落によるアメリカ側の影響と日本側の影響についてを話し合った。"
            },
            {
                id: 7,
                title: "渋沢栄一になるためには",
                filename: "shibusawa-eiichi.pdf",
                tags: ["ビジネス", "日本", "思想・哲学"],
                date: "2024.9.24",
                author_attr: "３年　那須 陽向",
                perspective: "「私益」と「公益」という相反する２つの経済的概念を両立させることが、経営の重要な要素であり、渋沢栄一のいう「道徳経済合一説」の本質の一部ではないかと考えた。",
                discussion: "まず、「私益」と「公益」について定義づけし、これらの具体的例を用いることで、その論理的整合性を確かめ、当該議論では、この「道徳経済合一説」は正しいが、現代では少し時代遅れである可能性がある。と結論づけた。"
            },
            {
                id: 8,
                title: "セブン「カナダからの手紙」再び",
                filename: "711-act.pdf",
                tags: ["ビジネス", "日本", "企業動向"],
                date: "2024.11.18",
                author_attr: "３年　伊知地 秋士",
                perspective: "傘下のスーパーや外食産業を中間持ち株会社にし、コンビニ事業に専念することで、ACTの買収提案に対抗しているのではないかと考えた。",
                discussion: "「コンビニ事業に専念することによる企業価値の上昇」以外の問題点として、消費者によるイメージと競合他社の成長という２つの問題とそのシナジーについて議論し、消費者のイメージの払拭するポイントがその２つの問題であるため、困難を極めるのではと論じた。"
            }
        ];

        // --- UI: Render Gallery (New Card Design) ---
        const cardContainer = document.getElementById('card-container');

        function renderGallery() {
            // 修正: href="${item.filename}" として、データ内のファイル名をリンク先に設定するようにしました。
            cardContainer.innerHTML = pdfData.map(item => `
                <a href="${item.filename}" target="_blank" rel="noopener noreferrer" class="academic-card p-6 cursor-pointer group flex flex-col h-full block hover:no-underline">
                    
                    <!-- Element A: Genre Tags -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        ${item.tags.map(tag => `
                            <span class="bg-gray-100 text-gray-700 text-xs font-bold px-3 py-1 rounded-full border border-gray-200">
                                ${tag}
                            </span>
                        `).join('')}
                    </div>

                    <!-- Element B: Title -->
                    <h3 class="text-2xl font-bold text-[#003366] mb-5 leading-snug font-serif group-hover:text-blue-800 transition-colors">
                        ${item.title}
                    </h3>

                    <div class="flex-grow space-y-4">
                        <!-- Element C: Perspective Section -->
                        <div class="bg-blue-50/50 border border-dashed border-blue-200 rounded-md p-4">
                            <h4 class="text-xs font-bold text-gray-500 mb-2 flex items-center">
                                <i class="fa-regular fa-user mr-2 text-gray-400"></i>
                                担当者の視点
                            </h4>
                            <p class="text-sm text-gray-700 leading-relaxed text-justify">
                                ${item.perspective}
                            </p>
                        </div>

                        <!-- Element D: Discussion Section -->
                        <div class="bg-blue-50/50 border border-dashed border-blue-200 rounded-md p-4">
                            <h4 class="text-xs font-bold text-gray-500 mb-2 flex items-center">
                                <i class="fa-solid fa-users mr-2 text-gray-400"></i>
                                議論の論点
                            </h4>
                            <p class="text-sm text-gray-700 leading-relaxed text-justify">
                                ${item.discussion}
                            </p>
                        </div>
                    </div>

                    <!-- Element E: Footer -->
                    <div class="mt-6 pt-4 border-t border-gray-100 flex items-center justify-between text-sm text-gray-500">
                        <div class="font-serif">
                            ${item.date}
                        </div>
                        <div class="flex items-center font-medium">
                            <i class="fa-solid fa-pen-nib mr-2 text-gray-400"></i>
                            ${item.author_attr}
                        </div>
                    </div>

                </a>
            `).join('');
        }

        // --- NAVIGATION & VIEWER LOGIC (Kept same) ---
        const galleryView = document.getElementById('gallery-view');
        const pdfView = document.getElementById('pdf-view');
        const viewerControls = document.getElementById('viewer-controls');
        const promptTitle = document.getElementById('prompt-title');
        const currentDocTitle = document.getElementById('current-doc-title');

        function openPdfViewer(title) {
            galleryView.classList.add('hidden');
            pdfView.classList.remove('hidden');
            viewerControls.classList.remove('hidden');
            
            resetViewer();
            promptTitle.textContent = title;
            currentDocTitle.textContent = title;
        }

        function showGallery() {
            galleryView.classList.remove('hidden');
            pdfView.classList.add('hidden');
            viewerControls.classList.add('hidden');
            resetViewer();
        }

        // --- PDF.js Implementation ---
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let pdfDoc = null;
        let pageNum = 1;
        let pageRendering = false;
        let pageNumPending = null;
        let scale = 1.0;
        let canvas = document.getElementById('the-canvas');
        let ctx = canvas.getContext('2d');

        const uploadPrompt = document.getElementById('upload-prompt');
        const viewerContainer = document.getElementById('viewer-container');
        const loading = document.getElementById('loading');
        const errorMsg = document.getElementById('error-message');

        function resetViewer() {
            pdfDoc = null;
            pageNum = 1;
            scale = 1.0;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            canvas.classList.add('hidden');
            uploadPrompt.classList.remove('hidden');
            viewerContainer.classList.add('hidden');
        }

        function renderPage(num) {
            pageRendering = true;
            pdfDoc.getPage(num).then(function(page) {
                const viewport = page.getViewport({scale: scale});
                const outputScale = window.devicePixelRatio || 1;

                canvas.width = Math.floor(viewport.width * outputScale);
                canvas.height = Math.floor(viewport.height * outputScale);
                canvas.style.width = Math.floor(viewport.width) + "px";
                canvas.style.height = Math.floor(viewport.height) + "px";

                const transform = outputScale !== 1 ? [outputScale, 0, 0, outputScale, 0, 0] : null;

                const renderContext = {
                    canvasContext: ctx,
                    transform: transform,
                    viewport: viewport
                };
                
                page.render(renderContext).promise.then(function() {
                    pageRendering = false;
                    canvas.classList.remove('hidden');
                    document.getElementById('page-num').value = num;
                    document.getElementById('zoom-level').textContent = Math.round(scale * 100) + '%';
                    
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                    
                    document.getElementById('prev').disabled = num <= 1;
                    document.getElementById('next').disabled = num >= pdfDoc.numPages;
                    document.getElementById('prev').style.opacity = num <= 1 ? "0.3" : "1";
                    document.getElementById('next').style.opacity = num >= pdfDoc.numPages ? "0.3" : "1";
                });
            });
        }

        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }

        function onPrevPage() {
            if (pageNum <= 1) return;
            pageNum--;
            queueRenderPage(pageNum);
        }

        function onNextPage() {
            if (pageNum >= pdfDoc.numPages) return;
            pageNum++;
            queueRenderPage(pageNum);
        }

        function onZoomIn() {
            if (scale >= 3.0) return;
            scale += 0.25;
            queueRenderPage(pageNum);
        }

        function onZoomOut() {
            if (scale <= 0.5) return;
            scale -= 0.25;
            queueRenderPage(pageNum);
        }

        function loadPDF(fileData) {
            loading.classList.remove('hidden');
            errorMsg.classList.add('hidden');

            pdfjsLib.getDocument(fileData).promise.then(function(pdfDoc_) {
                pdfDoc = pdfDoc_;
                document.getElementById('page-count').textContent = pdfDoc.numPages;
                pageNum = 1;
                scale = 1.0;
                
                uploadPrompt.classList.add('hidden');
                viewerContainer.classList.remove('hidden');
                loading.classList.add('hidden');
                renderPage(pageNum);
            }).catch(function(reason) {
                console.error(reason);
                loading.classList.add('hidden');
                document.getElementById('error-text').textContent = "ファイル形式が無効か破損しています。";
                errorMsg.classList.remove('hidden');
            });
        }

        document.getElementById('prev').addEventListener('click', onPrevPage);
        document.getElementById('next').addEventListener('click', onNextPage);
        document.getElementById('zoom-in').addEventListener('click', onZoomIn);
        document.getElementById('zoom-out').addEventListener('click', onZoomOut);
        
        document.getElementById('page-num').addEventListener('change', function() {
            const num = parseInt(this.value);
            if (num >= 1 && num <= pdfDoc.numPages) {
                pageNum = num;
                queueRenderPage(pageNum);
            }
        });

        const fileInput = document.getElementById('file-upload');
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type === "application/pdf") {
                const reader = new FileReader();
                reader.onload = (ev) => loadPDF(new Uint8Array(ev.target.result));
                reader.readAsArrayBuffer(file);
            }
        });

        const dropZone = document.getElementById('drop-zone');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            document.body.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
            }, false);
        });

        document.body.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0 && files[0].type === "application/pdf") {
                 if (!galleryView.classList.contains('hidden')) {
                    openPdfViewer(files[0].name);
                }
                const reader = new FileReader();
                reader.onload = (ev) => loadPDF(new Uint8Array(ev.target.result));
                reader.readAsArrayBuffer(files[0]);
            }
        }, false);

        document.addEventListener('keydown', (e) => {
            if (galleryView.classList.contains('hidden') && pdfDoc) {
                if (e.key === 'ArrowLeft') onPrevPage();
                if (e.key === 'ArrowRight') onNextPage();
            }
        });

        renderGallery();

    </script>
</body>
</html>